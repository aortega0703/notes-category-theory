\subsection{Pullbacks}

\begin{definition}[Pullback]\index{Pullback}
  A pullback is the limit of a
  diagram~\parencite[p.~114]{leinster:basic_category_theory}:
  % https://q.uiver.app/#q=WzAsMyxbMiwwLCJCIl0sWzAsMCwiQSJdLFsxLDAsIkMiXSxbMCwyLCJnIiwyXSxbMSwyLCJmIl1d
  \[\begin{tikzcd}[ampersand replacement=\&]
    A \& C \& B
    \arrow["g"', from=1-3, to=1-2]
    \arrow["f", from=1-1, to=1-2]
  \end{tikzcd}\]
\end{definition}

\begin{remark}
  A pullback candidate of objects and morphisms $A\overset{f}{\to} C
  \overset{g}{\from} B$ is composed of an object $X$ with morphisms
  $A\overset{x_0}{\from} X \overset{x_1}{\to} B$ such that $f \circ \pi_0 =
  g\circ \pi_1$. A pullback is a candidate $\<A\times_C B, \pi_*\>$ such that
  for any candidate $\<X, x_*\>$ there exists a unique morphism $h:X\to
  A\times_C B$ that makes $\pi_0 \circ h = x_0$ and $\pi_1 \circ h = x_1$ hold.
  % https://q.uiver.app/#q=WzAsNSxbMCwwLCJYIl0sWzEsMiwiQSJdLFsyLDEsIkIiXSxbMiwyLCJDIl0sWzEsMSwiQVxcdGltZXNfQyBCIl0sWzQsMSwiXFxwaV8wIiwyXSxbNCwyLCJcXHBpXzEiXSxbMSwzLCJmIiwyXSxbMiwzLCJnIl0sWzAsNCwiaCIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDEsInhfMCIsMix7ImN1cnZlIjoyfV0sWzAsMiwieF8xIiwwLHsiY3VydmUiOi0yfV0sWzQsMywiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d&macro_url=https%3A%2F%2Fgist.githubusercontent.com%2Faortega0703%2Fa1fd97cb097b8142e63a6fbf0cdb0f76%2Fraw%2Fb46a955b6b1f06908105b870088e59a10049fc60%2Fmacros.tex
  \[\begin{tikzcd}[ampersand replacement=\&]
    X \\
    \& {A\times_C B} \& B \\
    \& A \& C
    \arrow["{\pi_0}"', from=2-2, to=3-2]
    \arrow["{\pi_1}", from=2-2, to=2-3]
    \arrow["f"', from=3-2, to=3-3]
    \arrow["g", from=2-3, to=3-3]
    \arrow["h", dashed, from=1-1, to=2-2]
    \arrow["{x_0}"', curve={height=12pt}, from=1-1, to=3-2]
    \arrow["{x_1}", curve={height=-12pt}, from=1-1, to=2-3]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
  \end{tikzcd}\]

  Here $\lrcorner$ is used to indicate the object that makes
  that is completing the pullback square. Also, $\pi_0$ is sometimes called
  ``the pullback of $g$ along $f$'' and similarly $\pi_1$ is ``the pullback of
  $f$ along $g$''. Pullbacks are sometimes called fibred products.
\end{remark}

\begin{theorem}
  Pullback squares preserve monomorphisms, i.e. if $g$ is a monomorphism in the
  following pullback square then so is $\pi_1$:
  % https://q.uiver.app/#q=WzAsNCxbMSwwLCJCIl0sWzAsMSwiQSJdLFsxLDEsIkMiXSxbMCwwLCJBXFx0aW1lc19DQiJdLFswLDIsImciLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJtb25vIn19fV0sWzEsMiwiZiIsMl0sWzMsMSwiXFxwaV8wIiwyXSxbMywwLCJcXHBpXzEiXSxbMywyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
  \[\begin{tikzcd}[ampersand replacement=\&]
    {A\times_CB} \& B \\
    A \& C
    \arrow["g", tail, from=1-2, to=2-2]
    \arrow["f"', from=2-1, to=2-2]
    \arrow["{\pi_0}"', from=1-1, to=2-1]
    \arrow["{\pi_1}", from=1-1, to=1-2]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
  \end{tikzcd}\]

  \begin{proof}
    Consider an object $X$ with morphisms $p, q: X\to A\times_C B$ such that
    $\pi_0 \circ p = \pi_0 \circ q$, then:
    \[
      \begin{aligned}
        \pi_0 \circ p &= \pi_0 \circ q\\
        f \circ \pi_0 \circ p &= f \circ \pi_0 \circ q\\
        g \circ \pi_1 \circ p &= g \circ \pi_1 \circ q\\
        \pi_1 \circ p &= \pi_1 \circ q
      \end{aligned}
    \]

    $X$ has morphisms into $A$ and $B$, namely $\pi_0 \circ p$, $\pi_0 \circ q$
    and $\pi_1 \circ p$, $\pi_1 \circ q$. Then, there must be a unique $h: X\to
    A\times_C B$ such that they are equal to $\pi_0 \circ h$ and $\pi_1 \circ
    h$, implying that $p=q=h$.
  \end{proof}
\end{theorem}

\begin{theorem}
  The following set-up of pullback squares implies that the outter rectangle
  is another pullback:
  % https://q.uiver.app/#q=WzAsNixbMiwxLCJEIl0sWzEsMSwiQiJdLFsyLDAsIkMiXSxbMCwxLCJBIl0sWzEsMCwiQlxcdGltZXNfRCBDIl0sWzAsMCwiQVxcdGltZXNfQihCXFx0aW1lc19EIEMpIl0sWzQsMSwiXFxwaV8wIiwyXSxbNCwyLCJcXHBpXzEiXSxbMSwwLCJmIiwyXSxbMiwwLCJnIl0sWzMsMSwiaCIsMl0sWzUsMywiXFxyaG9fMCIsMl0sWzUsNCwiXFxyaG9fMSJdLFs0LDAsIiIsMix7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dLFs1LDEsIiIsMix7InN0eWxlIjp7Im5hbWUiOiJjb3JuZXIifX1dXQ==
  \[\begin{tikzcd}[ampersand replacement=\&]
    {A\times_B(B\times_D C)} \& {B\times_D C} \& C \\
    A \& B \& D
    \arrow["{\pi_0}"', from=1-2, to=2-2]
    \arrow["{\pi_1}", from=1-2, to=1-3]
    \arrow["f"', from=2-2, to=2-3]
    \arrow["g", from=1-3, to=2-3]
    \arrow["h"', from=2-1, to=2-2]
    \arrow["{\rho_0}"', from=1-1, to=2-1]
    \arrow["{\rho_1}", from=1-1, to=1-2]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-2, to=2-3]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
  \end{tikzcd}\]

  Put another way, $A\times_B (B\times_D C) \cong A\times_D C$.
  \begin{proof}
    Consider an object $X$ with morphisms $p: X\to A$ and $q:X\to C$. As there
    are morphism from $X$ to $B$ and $C$ namely $h\circ p$ and $q$, there must
    be a unique morphism $\delta: X\to A\times_C B$ such that:
    \[
      \begin{gathered}
        h\circ p = \pi_0 \circ \delta
      \end{gathered}
      \qquad
      \begin{gathered}
        q = \pi_1 \circ \delta
      \end{gathered}
    \]

    Now, as there are morphisms from $X$ to $A$ and $B\times_D C$ namely $p$ and
    $\delta$, there must exist a unique morphism $\varepsilon: X\to
    A\times_B(B\times_D C)$ such that:
    \[
      \begin{gathered}
        p = \rho_0 \circ \varepsilon
      \end{gathered}
      \qquad
      \begin{gathered}
        \delta = \rho_1 \circ \varepsilon
      \end{gathered}
    \]

    Therefore, for any object $X$ with morphisms $p:X\to A$ and $q:X\to C$ there
    is a unique morphism $\epsilon: X\to A\times_B(B\times_D C)$ that factors
    them as $p=\rho_0 \circ \varepsilon$ and $q=\pi_1\circ \rho_1\circ
    \varepsilon$ making $A\times_B(B\times_D C)$ the pullback of $A$ and $C$.
    Finally by Theorem \ref{thm:limit_iso} $A\times_B(B\times_D C) \cong
    A\times_D C$.
  \end{proof}
\end{theorem}

\begin{theorem}\label{thm:product_from_pullback}
  For a category with a terminal object $1$, the product of objects $A, B$ can
  be constructed using pullbacks.

  \begin{proof}
    % https://q.uiver.app/#q=WzAsNSxbMSwyLCJBIl0sWzIsMSwiQiJdLFsyLDIsIjEiXSxbMSwxLCJBXFx0aW1lc18xIEIiXSxbMCwwLCJYIl0sWzAsMiwiZiIsMl0sWzEsMiwiZyJdLFszLDAsIlxccGlfMCIsMl0sWzMsMSwiXFxwaV8xIl0sWzQsMywiaCIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFs0LDAsInhfMCIsMix7ImN1cnZlIjoxfV0sWzQsMSwieF8xIiwwLHsiY3VydmUiOi0xfV0sWzMsMiwiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d
    \[\begin{tikzcd}[ampersand replacement=\&]
      X \\
      \& {A\times_1 B} \& B \\
      \& A \& 1
      \arrow["f"', from=3-2, to=3-3]
      \arrow["g", from=2-3, to=3-3]
      \arrow["{\pi_0}"', from=2-2, to=3-2]
      \arrow["{\pi_1}", from=2-2, to=2-3]
      \arrow["h", dashed, from=1-1, to=2-2]
      \arrow["{x_0}"', curve={height=6pt}, from=1-1, to=3-2]
      \arrow["{x_1}", curve={height=-6pt}, from=1-1, to=2-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
    \end{tikzcd}\]

    Consider the pullback $A\times_1 B$. As there are morphisms $\pi_0, \pi_1$
    from it to $A$ and $B$, it is a product candidate. Consider another product
    candidate $\<X, x_*\>$ as shown in the diagram. There is a unique morphism
    $X\to 1$, therefore $f\circ x_0 = g\circ x_1$ making it a pullback
    candidate. Then by the universal property of pullbacks there exists a unique
    morphism $h:X\to A\times_1 B$ such that $x_0 = \pi_0\circ h$ and $x_1 =
    \pi_1\circ h$.
  \end{proof}
\end{theorem}

\begin{theorem}\label{thm:equalizer_from_pullback}
  The equalizer of arrows $f,g:A\to B$ can be constructed using pullbacks and
  products.

  \begin{proof}
    % https://q.uiver.app/#q=WzAsNSxbMSwyLCJBIl0sWzIsMiwiQVxcdGltZXMgQiJdLFsyLDEsIkEiXSxbMSwxLCJDIl0sWzAsMCwiWCJdLFswLDEsIlxcbGFuZ2xlIFxcaWRfQSwgZlxccmFuZ2xlIiwyXSxbMiwxLCJcXGxhbmdsZSBcXGlkX0EsIGdcXHJhbmdsZSJdLFszLDIsIlxccGlfMSJdLFszLDAsIlxccGlfMCIsMl0sWzQsMywiaCIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFs0LDAsInhfMCIsMix7ImN1cnZlIjoxfV0sWzQsMiwieF8xIiwwLHsiY3VydmUiOi0xfV0sWzMsMSwiIiwwLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lciJ9fV1d&macro_url=https%3A%2F%2Fgist.githubusercontent.com%2Faortega0703%2Fa1fd97cb097b8142e63a6fbf0cdb0f76%2Fraw%2Fb46a955b6b1f06908105b870088e59a10049fc60%2Fmacros.tex
    \[\begin{tikzcd}[ampersand replacement=\&]
      X \\
      \& C \& A \\
      \& A \& {A\times B}
      \arrow["{\langle \id_A, f\rangle}"', from=3-2, to=3-3]
      \arrow["{\langle \id_A, g\rangle}", from=2-3, to=3-3]
      \arrow["{\pi_1}", from=2-2, to=2-3]
      \arrow["{\pi_0}"', from=2-2, to=3-2]
      \arrow["h", dashed, from=1-1, to=2-2]
      \arrow["{x_0}"', curve={height=6pt}, from=1-1, to=3-2]
      \arrow["{x_1}", curve={height=-6pt}, from=1-1, to=2-3]
      \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=2-2, to=3-3]
    \end{tikzcd}\]

    Consider a pullback $\<C, \pi_*\>$ as shown in the diagram, then:
    \[
      \begin{aligned}
        \<\id_A, f\> \circ \pi_0 &= \<\id_A, g\> \circ \pi_1\\
        \<\id_A\circ\pi_0,f\circ\pi_0\> &= \<\id_A\circ\pi_0, g\circ\pi_0\>\\
        \pi_0 = \pi_1 \qquad&\phantom{=}\qquad f\circ \pi_0 = g\circ \pi_1
      \end{aligned}
    \]

    Therefore $\<C, \pi_*\>$ is an equalizer candidate for $f,g$. Consider
    another equalizer candidate $\<X, x\>$ such that $\<\id_A, f\> \circ x =
    \<\id_A, g\> \circ x$, then:
    \[
      \begin{aligned}
        \id_A \circ x = \id_A \circ x \qquad&\phantom{=}\qquad f\circ x = g\circ x\\
        \<\id_A \circ x, f\circ x\> &= \<\id_A \circ x, g\circ x\>\\
        \<\id_A, f\> \circ x &= \<\id_A, g\> \circ x
      \end{aligned}
    \]

    Making $\<X, x\>$ also a pullback candidate. By the universal property of
    pullbacks, there exists a unique morphism $h: X\to C$ such that $x =
    \pi_*\circ h$.
  \end{proof}
\end{theorem}

\begin{theorem}
  A category with a terminal object and all pullbacks is complete.

  \begin{proof}
    By Theorems \ref{thm:complete_product_equalizer},
    \ref{thm:product_from_pullback}, \ref{thm:equalizer_from_pullback}
  \end{proof}
\end{theorem}